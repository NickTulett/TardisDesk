<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="TardisDesk : How I built and enhanced a standing desk to fit my needs when working from home long term">
    <link rel="stylesheet" type="text/css" media="screen" href="/TardisDesk/assets/css/style.css?v=b6db1b269f812109216ea89ccfd04948be0f69dc">
    <title>TardisDesk</title>
    <style type="text/css">
    .inner {
        max-width: 800px;
    }
    </style>
</head>

<body>
    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
            <!--<a id="forkme_banner" href="https://github.com/NickTulett/TardisDesk">View on GitHub</a>-->
            <h1 id="project_title">TardisDesk</h1>
            <h2 id="project_tagline">How I built and enhanced a standing desk to fit my needs when working from home long term</h2>
        </header>
    </div>
    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
        <section id="main_content" class="inner">
            <h1>Building the Tardis Desk</h1>
            <h2>An interactive standing desk for working from home</h2>
            <h3>Background</h3>
            <p>A couple of years ago I got interested in the idea of building a standing desk for those times when I was working from home. I was then using a bog-standard sitting desk and had moved my office around the house as DIY projects and family demands dictated.</p>
            <p>I had started to measure things up and sketched out a design for the desk frame when coincidentally yet another redecoration project made an old wardrobe redundant. As I started emptying it and thought about smashing it to bits, the carcass suddenly seemed to me to be about the same dimensions as the desk I had planned.</p>
            <p>Never being one to waste money or wood, I fitted some extra shelving inside the wardrobe, installed my PC and a couple of monitors and hey presto, a functional standing desk practically for free.</p>
            <h3>Becoming a Tardis</h3>
            <p>Functional but boring, so I began to think about giving it a lick of paint. I decided to pick a theme based on a possibly the most famous standing desk of all time - the Tardis</p>
            <p>I had to chisel off the faux-deco panels to get 2 flat doors, then made some framing panels from MDF, pinned and glued them into place and gave the whole thing a couple of coats of dark blue paint. I wasn't too fussed about the quality of the finish as I wanted it to look a bit weather-beaten.</p>
            <p>I masked off the top panel in each door to let the white undercoat show through for the top windows(?). A black POLICE BOX roof sign and the white FOR USE OF PUBLIC door signs were printed off and the Tardis was complete. Even more complete that Xmas when I was gifted a revolving police light.</p>
            <p> I decorated the insides of the doors with some spacey vinyl from a old conference display that was being thrown out at work and the guts of some dead hard drives and scrap 80s computers from eBay.</p>
            <h3>Becoming Interactive</h3>
            <p>So the decoration was done and gave me a little lift every time I walked past the spare room and saw my own Tardis brooding in the corner - believe me you do need something to make you smile every now and then if you work from home for any length of time.</p>
            <p>When I thought about my memories of the Tardis in the 70s and 80s, it was all dials, knobs, gauges and screens. I started to browse eBay looking for old equipment panels to decorate the blank spaces in the desks. I managed to get a job-lot of old moving coil gauges and aircraft equipment and laid them out on some plywood cut to fit the gap in the desk. I also added a Muirhead radio test set which had some nicely tactile rheostats.</p>
            <p>Now I'm not sure what sparked the original idea but I have been acquiring Raspberry Pis since the first models came out but had never done anything with the GPIO pins - due to a lack of knowledge and a suitable project. I saw that some people had used Pis to drive old gauges for clocks and bandwidth monitors and wondered if I could do something similar.</p>
            <p>I read up about it, got myself a carton of 600+ resistors of different ratings and a bunch of dupont cables. Granted I should have done this properly and read the rating of each gauge and calculated the correct resistor to use, but I just went with trial and error - starting with the largest size, switching the pin on and seeing if and how far the needle moved.</p>
            <p>Once I had sorted out and made notes of the resistors, put the dead gauges to one side and laid out the good gauges, I cut the plywood to allow the gauges to sit slightly proud and leave the contact free at the back. I just happened to have an enormous roll of metallic "sticky-back paper", so I applied that to the plywood to create a fake metal panel for the gauges to sit on.</p>
            <img src="images/instrument_panel.jpg">
            <p>I decided what to indicate with each gauge and Dymo'd some labels and wired it all up. To my astonishment, one Pi B was able to handle a dozen gauges, a physical switch and a bunch of LEDs simultaneously (as well as running MPD and Mercurial servers in the background).</p>
            <img src="images/dymo_labels.jpg">
            <h3>The gauges and the code</h3>
            <ul>
                <li>CPU and GPU temperatures (scaled to indicate max as 100C)</li>
                <li>CPU load (scaled to indicate max as 100%)</li>
                <li>RAM usage</li>
                <li>Network usage in and out</li>
                <li>VPN usage</li>
                <li>Disk usage</li>
                <li>Outside temperature</li>
                <li>The inevitable clock - using 2 gauges and 3 LEDs for over-engineering points</li>
            </ul>
            <p>The basic principle for driving a moving coil gauge is to connect the postive and negative contacts to a GPIO pin (via a resistor) and ground respectively and then send a PWM signal via GPIO to move the needle. I used a Pi-Cobbler to connect the pi to a breadboard. My first attempt involved fitting the resistors between 2 female-ended dupont wires but the wiring became completely chaotic and kept snagging and breaking the connections.</p>
            <img src="images/inline_resistors.jpg">
            <p>My second attempt involved inserting the resistors into the breadboard and using short M-M dupont wires to connect to the GPIO pins and ground rails. This allowed me to tidy up the wiring so that they would not cross (in theory) but the end result was still spaghetti.</p>
            <img src="images/spaghetti.jpg">
            <h3>Switches and dials</h3>
            <p>So far, so good. We have lots of outputs updating in near real-time, but how about adding some input controls?</p>
            <p>Something I have to do every time I work from home is connect to the VPN at work, so how about making a switch for this? Obviously it couldn't be any ordinary toggle switch, it had to be a missile switch with a flip cover</p>
            <img src="images/vpn_switch.jpg">
            <p>Over to the right I added an illuminated toggle switch to switch off the privoxy server running on another Pi, through which my daughter's devices connect to the web. This enables me to make good on the almost daily threat: <em>"If you don't brush your teeth, I'm turning the internet off"</em>.</p>
            <p>The last input was a good deal more complex. I wanted to use at least on of the rheostats on the Muirhead radio test set to control the volume of my sound card (despite having a dedicated volume control knob on my desk as well as volume buttons on one of my keyboards). I had some vague idea about the knobs varying resistance as measured with a multimeter, but I had run out of pins on my Pi and didn't really know how to approach it, so I put it on the back burner.</p>
            <p>A few months later I was really into cheap Arduino clones, especially the NodeMCU variants, and stumbled upon <a href="https://forum.arduino.cc/index.php?topic=52985.0">this question</a> in the Arduino forums. That gave me the confidence to try hooking up the Muirhead rheostat(s) to the analog pin on a NodeMCU using (what I think is) a voltage divider. It detects changes in the position of 2 of the rheostats and sends a request to the PC (via the Pi) to adjust its volume. One dial controls large volume adjustments and the other fine adjustments. This is of course completely pointless, I just wanted to see if it was possible and how to do it.</p>
            <pre><code>
//Arduino code for NodeMCU reading the Muirhead rheostats

int muirhead;
int lastDialValue = 0;

void setVolume() {
  Serial.println(muirhead);
  Serial.println("http://192.168.1.83:8884/?value=" + (String)muirhead);
  HTTPClient http;
  http.begin("http://192.168.1.83:8884/?value=" + (String)muirhead);
  int httpCode = http.GET();  
  Serial.println(httpCode);
}

void loop() {
  muirhead = analogRead(A0);
  if (abs(muirhead - lastDialValue) > 20) {
    setVolume();
    lastDialValue = muirhead;
  }
}              
            </code></pre>
            <pre><code>
//node.js code on the Pi that responds to requests from the NodeMCU 
//and translates the parameter into a volume value to be set over ssh              

function volumeLevel(dialValue) {
//the NodeMCU analog reading is from 0 to 1024 (in reverse order)
//7.3 is a scalar arrived at by trial and error
//to translate this to a suitable percentage
  return Math.floor((1024 - dialValue) / 7.3);
}

var server = http.createServer(function (request, response) {
  console.dir(request.url);
  var value = url.parse(request.url, true).query.value;
  if (value) {
    console.log("setting volume " + value);
    sshCall("pactl set-sink-volume 0 " + volumeLevel(value) + "%");
      console.log("volume set");
  }
  response.writeHead(200, {'Content-Type': 'text/plain'});
    response.end("OK");
});
            </code></pre>
        </section>
    </div>
    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
        <footer class="inner">
            <p class="copyright">TardisDesk maintained by <a href="https://github.com/NickTulett">NickTulett</a></p>
            <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
        </footer>
    </div>
</body>

</html>
